(function(n){function t(){this.isField=!0;this.keyboardMode=this.hasLabel=this.cutOff=this.disabled=this.inFocus=this.down=!1;this.nativeTouch=!0;this.wrapperClass="dropdown";this.onChange=null}t.prototype={constructor:t,instances:{},init:function(t,i){var r=this;n.extend(r,i);r.$select=n(t);r.id=t.id;r.options=[];r.$options=r.$select.find("option");r.isTouch="ontouchend"in document;r.$select.removeClass(r.wrapperClass+" dropdown");r.$select.is(":disabled")&&(r.disabled=!0);r.$options.length&&(r.$options.each(function(t){var i=n(this);i.is(":selected")&&(r.selected={index:t,title:i.text(),icon:typeof i.attr("data-icon")!="undefined"?'<img src="'+i.attr("data-icon")+'" />':""},r.focusIndex=t);i.hasClass("label")&&0==t?(r.hasLabel=!0,r.label=i.text(),i.attr("value","")):r.options.push({domNode:i[0],title:i.text(),value:i.val(),selected:i.is(":selected"),icon:typeof i.attr("data-icon")!="undefined"?'<img src="'+i.attr("data-icon")+'" />':""})}),r.selected||(r.selected={index:0,title:r.$options.eq(0).text()},r.focusIndex=0),r.render())},render:function(){var t=this;t.$container=t.$select.wrap('<div class="'+t.wrapperClass+(t.isTouch&&t.nativeTouch?" touch":"")+(t.disabled?" disabled":"")+'"><span class="old"/><\/div>').parent().parent();t.$active=n('<span class="selected">'+t.selected.icon+t.selected.title+"<\/span>").appendTo(t.$container);t.$carat=n('<span class="carat"/>').appendTo(t.$container);t.$scrollWrapper=n("<div><ul/><\/div>").appendTo(t.$container);t.$dropDown=t.$scrollWrapper.find("ul");t.$form=t.$container.closest("form");n.each(t.options,function(){t.$dropDown.append("<li"+(this.selected?' class="active"':"")+">"+this.icon+this.title+"<\/li>")});t.$items=t.$dropDown.find("li");t.cutOff&&t.$items.length>t.cutOff&&t.$container.addClass("scrollable");t.getMaxHeight();t.isTouch&&t.nativeTouch?t.bindTouchHandlers():t.bindHandlers()},getMaxHeight:function(){for(i=this.maxHeight=0;i<this.$items.length;i++){var n=this.$items.eq(i);if(this.maxHeight+=n.outerHeight(),this.cutOff==i+1)break}},bindTouchHandlers:function(){var t=this;t.$container.on("click.easyDropDown",function(){t.$select.focus()});t.$select.on({change:function(){var i=n(this).find("option:selected"),r=i.text(),i=i.val();t.$active.text(r);"function"==typeof t.onChange&&t.onChange.call(t.$select[0],{title:r,value:i})},focus:function(){t.$container.addClass("focus")},blur:function(){t.$container.removeClass("focus")}})},bindHandlers:function(){var t=this;t.query="";t.$container.on({"click.easyDropDown":function(){t.down||t.disabled?t.close():t.open()},"mousemove.easyDropDown":function(){t.keyboardMode&&(t.keyboardMode=!1)}});n("body").on("click.easyDropDown."+t.id,function(i){i=n(i.target);var r=t.wrapperClass.split(" ").join(".");!i.closest("."+r).length&&t.down&&t.close()});t.$items.on({"click.easyDropDown":function(){var i=n(this).index();t.select(i);t.$select.focus()},"mouseover.easyDropDown":function(){if(!t.keyboardMode){var i=n(this);i.addClass("focus").siblings().removeClass("focus");t.focusIndex=i.index()}},"mouseout.easyDropDown":function(){t.keyboardMode||n(this).removeClass("focus")}});t.$select.on({"focus.easyDropDown":function(){t.$container.addClass("focus");t.inFocus=!0},"blur.easyDropDown":function(){t.$container.removeClass("focus");t.inFocus=!1},"keydown.easyDropDown":function(n){if(t.inFocus){t.keyboardMode=!0;var i=n.keyCode;if((38==i||40==i||32==i)&&(n.preventDefault(),38==i?(t.focusIndex--,t.focusIndex=0>t.focusIndex?t.$items.length-1:t.focusIndex):40==i&&(t.focusIndex++,t.focusIndex=t.focusIndex>t.$items.length-1?0:t.focusIndex),t.down||t.open(),t.$items.removeClass("focus").eq(t.focusIndex).addClass("focus"),t.cutOff&&t.scrollToView(),t.query=""),t.down)if(9==i||27==i)t.close();else{if(13==i)return n.preventDefault(),t.select(t.focusIndex),t.close(),!1;if(8==i)return n.preventDefault(),t.query=t.query.slice(0,-1),t.search(),clearTimeout(t.resetQuery),!1;38!=i&&40!=i&&(n=String.fromCharCode(i),t.query+=n,t.search(),clearTimeout(t.resetQuery))}}},"keyup.easyDropDown":function(){t.resetQuery=setTimeout(function(){t.query=""},1200)}});t.$dropDown.on("scroll.easyDropDown",function(){t.$dropDown[0].scrollTop>=t.$dropDown[0].scrollHeight-t.maxHeight?t.$container.addClass("bottom"):t.$container.removeClass("bottom")});if(t.$form.length)t.$form.on("reset.easyDropDown",function(){t.$active.text(t.hasLabel?t.label:t.options[0].title)})},unbindHandlers:function(){this.$container.add(this.$select).add(this.$items).add(this.$form).add(this.$dropDown).off(".easyDropDown");n("body").off("."+this.id)},open:function(){var n=window.scrollY||document.documentElement.scrollTop,t=window.scrollX||document.documentElement.scrollLeft,i=this.notInViewport(n);this.closeAll();this.getMaxHeight();this.$select.focus();window.scrollTo(t,n+i);this.$container.addClass("open");this.$scrollWrapper.css("height",this.maxHeight+"px");this.down=!0},close:function(){this.$container.removeClass("open");this.$scrollWrapper.css("height","0px");this.focusIndex=this.selected.index;this.query="";this.down=!1},closeAll:function(){var n=Object.getPrototypeOf(this).instances;for(var t in n)n[t].close()},select:function(n){var t,r,u;"string"==typeof n&&(n=this.$select.find("option[value="+n+"]").index()-1);t=this.options[n];r=this.hasLabel?n+1:n;this.$items.removeClass("active").eq(n).addClass("active");this.$select.find("option").removeAttr("selected").eq(r).prop("selected",!0).parent().trigger("change");u=typeof this.$select.find("option:selected").attr("data-icon")!="undefined"?'<img src="'+this.$select.find("option:selected").attr("data-icon")+'" />':"";this.$active.html(u+t.title);this.selected={index:n,title:t.title};this.focusIndex=i;"function"==typeof this.onChange&&this.onChange.call(this.$select[0],{title:t.title,value:t.value})},search:function(){var n=this,r=function(t){n.focusIndex=t;n.$items.removeClass("focus").eq(n.focusIndex).addClass("focus");n.scrollToView()},t;for(i=0;i<n.options.length;i++)if(t=n.options[i].title.toUpperCase(),0==t.indexOf(n.query)){r(i);return}for(i=0;i<n.options.length;i++)if(t=n.options[i].title.toUpperCase(),-1<t.indexOf(n.query)){r(i);break}},scrollToView:function(){if(this.focusIndex>=this.cutOff){var n=this.$items.eq(this.focusIndex).outerHeight()*(this.focusIndex+1)-this.maxHeight;this.$dropDown.scrollTop(n)}},notInViewport:function(n){var i=n+(window.innerHeight||document.documentElement.clientHeight),t=this.$dropDown.offset().top+this.maxHeight;return t>=n&&t<=i?0:t-i+5},destroy:function(){this.unbindHandlers();this.$select.unwrap().siblings().remove();this.$select.unwrap();delete Object.getPrototypeOf(this).instances[this.$select[0].id]},disable:function(){this.disabled=!0;this.$container.addClass("disabled");this.$select.attr("disabled",!0);this.down||this.close()},enable:function(){this.disabled=!1;this.$container.removeClass("disabled");this.$select.attr("disabled",!1)}};var r=function(n,i){n.id=n.id?n.id:"EasyDropDown"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase();var r=new t;r.instances[n.id]||(r.instances[n.id]=r,r.init(n,i))};n.fn.easyDropDown=function(){var n=arguments,i=[],u;return u=this.each(function(){if(n&&"string"==typeof n[0]){var u=t.prototype.instances[this.id][n[0]](n[1],n[2]);u&&i.push(u)}else r(this,n[0])}),i.length?1<i.length?i:i[0]:u};n(function(){"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(n){return n.__proto__}:function(n){return n.constructor.prototype});n("select.dropdown").each(function(){var t=n(this).attr("data-settings");settings=t?n.parseJSON(t):{};r(this,settings)})})})(jQuery)