/*
* EASYDROPDOWN - A Drop-down Builder for Styleable Inputs and Menus
* Version: 1.0
* License: Creative Commons Attribution 3.0 Unported - CC BY 3.0
* http://creativecommons.org/licenses/by/3.0/
* This software may be used freely on commercial and non-commercial projects with attribution to the author/copyright holder.
* Author: Patrick Kunka
* Copyright 2013 Patrick Kunka, All Rights Reserved
*/

(function(d){function e(){this.isField=!0;this.cutOff=this.inFocus=this.down=!1;this.wrapperClass="dropdown";this.onSelect=null}function f(a,b){var c=new e;c.init(a,b);c.instances.push(c)}e.prototype={constructor:e,instances:[],init:function(a,b){var c=this;d.extend(c,b);c.$select=d(a);c.options=[];c.$select.removeClass(c.wrapperClass).find("option").each(function(a){var b=d(this);b.is(":selected")&&(c.selected={index:a,title:b.text()},c.focusIndex=a);c.options.push({domNode:b[0],title:b.text(),value:b.val(),
selected:b.is(":selected")})});c.render()},render:function(){var a=this;a.$container=a.$select.wrap('<div class="'+a.wrapperClass+'"/>').parent();a.$active=d('<span class="selected">'+a.selected.title+"</span>").appendTo(a.$container);a.$carat=d('<span class="carat"/>').appendTo(a.$container);a.$scrollWrapper=d('<div class="scroll-wrapper"><ul></ul></div>').appendTo(a.$container);a.$dropDown=a.$scrollWrapper.find("ul");d.each(a.options,function(){a.$dropDown.append("<li"+(this.selected?' class="active"':
"")+">"+this.title+"</li>")});a.$items=a.$dropDown.find("li");for(i=a.maxHeight=0;i<a.$items.length;i++){var b=a.$items.eq(i);a.maxHeight+=b.outerHeight();if(a.cutOff==i+1)break}a.bindHandlers()},bindHandlers:function(){var a=this;a.query="";a.$container.on("click",function(){a.down?a.close():a.open()});d("body").on("click",function(b){!d(b.target).closest("."+a.wrapperClass).length&&a.down&&a.close()});a.$items.on("click",function(){var b=d(this).index();a.select(b)});a.$select.on({focus:function(){a.$container.addClass("focus");
a.inFocus=!0},blur:function(){a.$container.removeClass("focus");a.inFocus=!1}});d(window).on("keydown",function(b){if(a.inFocus){var c=b.keyCode;if(38==c||40==c||32==c)b.preventDefault(),38==c?(a.focusIndex--,a.focusIndex=0>a.focusIndex?a.$items.length-1:a.focusIndex):40==c&&(a.focusIndex++,a.focusIndex=a.focusIndex>a.$items.length-1?0:a.focusIndex),a.down||a.open(),a.$items.removeClass("focus").eq(a.focusIndex).addClass("focus"),a.query="";a.down&&(9==c||27==c?a.close():13==c?(a.select(a.focusIndex),
a.close()):8==c?(b.preventDefault(),a.query=a.query.slice(0,-1),a.search()):38!=c&&40!=c&&(b=String.fromCharCode(c),a.query+=b,a.search()))}})},open:function(){var a=window.scrollX,b=window.scrollY;this.closeAll();this.$select.focus();window.scrollTo(a,b);this.$container.addClass("open");this.$scrollWrapper.css("height",this.maxHeight+"px");this.down=!0},close:function(){this.$select.blur();this.$container.removeClass("open");this.$scrollWrapper.css("height","0px");this.focusIndex=this.selected.index;
this.query="";this.down=!1},closeAll:function(){var a=this.__proto__.instances;for(i=0;i<a.length;i++)a[i].close()},select:function(a){var b=this.options[a];this.$items.removeClass("active").eq(a).addClass("active");this.$active.text(b.title);this.$select.find("option").prop("selected",!1).eq(a).prop("selected","selected");this.selected={index:a,title:b.title};this.focusIndex=i;"function"==typeof this.onSelect&&this.onSelect.call(this,{title:b.title,value:b.value})},search:function(){for(i=0;i<this.options.length;i++)if(-1!=
this.options[i].title.toUpperCase().indexOf(this.query)){this.focusIndex=i;this.$items.removeClass("focus").eq(this.focusIndex).addClass("focus");break}}};d.fn.easyDropDown=function(a){return this.each(function(){f(this,a)})};d(function(){d(".dropdown").each(function(){var a=d(this).attr("data-settings");settings=a?a:{};f(this,settings)})})})(jQuery);